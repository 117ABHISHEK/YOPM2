<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}LearnLog{% endblock %}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    {% block head_extra %}{% endblock %}
  </head>
  <body>
    <div>{% block content %}{% endblock %}</div>

    <script type="application/json" id="flash-data">
      {{ get_flashed_messages(with_categories=true) | tojson | safe }}
    </script>

    <script>
      const flashDataEl = document.getElementById("flash-data");
      const flashMessages = flashDataEl
        ? JSON.parse(flashDataEl.textContent)
        : [];

      const iconMap = {
        danger: "error",
        warning: "warning",
        success: "success",
        info: "info",
        message: "info",
      };

      if (Array.isArray(flashMessages)) {
        flashMessages.forEach(([category, message]) => {
          const iconType = iconMap[category] || "info";
          Swal.fire({
            toast: true,
            position: "top-end",
            icon: iconType,
            title: message,
            showConfirmButton: false,
            timer: 3500,
            timerProgressBar: true,
            didOpen: (toast) => {
              toast.addEventListener("mouseenter", Swal.stopTimer);
              toast.addEventListener("mouseleave", Swal.resumeTimer);
            },
          });
        });
      }
    </script>

    <script>
      function confirmDelete(event, url) {
        event.preventDefault();
        Swal.fire({
          title: "Are you sure?",
          text: "You won't be able to revert this!",
          icon: "warning",
          showConfirmButton: true,
          showCancelButton: true,
          confirmButtonColor: "#d33",
          cancelButtonColor: "#6e7881",
          confirmButtonText: "Yes, delete it!",
        }).then((result) => {
          if (result.isConfirmed) {
            window.location.href = url;
          }
        });
      }
    </script>

    {% block scripts %}{% endblock %}
  </body>
</html>
